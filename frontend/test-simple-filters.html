<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>简单筛选测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .filter-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .filter-group {
            margin-bottom: 15px;
        }
        .filter-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .color-swatch {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            border: 2px solid #ccc;
            display: inline-block;
        }
        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-secondary {
            background-color: #6c757d;
            color: white;
        }
        .results {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>简单筛选功能测试</h1>
    
    <div class="test-section">
        <h2>筛选面板</h2>
        <div class="filter-panel">
            <div class="filter-group">
                <label>价格范围:</label>
                <select id="price-filter">
                    <option value="">全部价格</option>
                    <option value="0-50">¥0 - ¥50</option>
                    <option value="50-100">¥50 - ¥100</option>
                    <option value="100-200">¥100 - ¥200</option>
                    <option value="200-300">¥200 - ¥300</option>
                    <option value="300+">¥300以上</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label>颜色:</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="color-white" value="COL00,COL01,COL02,COL03,COL04">
                        <span class="color-swatch" style="background-color: #FFFFFF; border-color: #DDD;"></span>
                        <label for="color-white">白色系</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="color-black" value="COL09">
                        <span class="color-swatch" style="background-color: #000000;"></span>
                        <label for="color-black">黑色系</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="color-red" value="COL13,COL14,COL15,COL16">
                        <span class="color-swatch" style="background-color: #FF0000;"></span>
                        <label for="color-red">红色系</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="color-blue" value="COL33,COL34,COL35,COL36,COL37">
                        <span class="color-swatch" style="background-color: #0000FF;"></span>
                        <label for="color-blue">蓝色系</label>
                    </div>
                </div>
            </div>
            
            <div class="filter-group">
                <label>尺码:</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="size-s" value="SMA003">
                        <label for="size-s">S</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="size-m" value="SMA004">
                        <label for="size-m">M</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="size-l" value="SMA005">
                        <label for="size-l">L</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="size-xl" value="SMA006">
                        <label for="size-xl">XL</label>
                    </div>
                </div>
            </div>
            
            <div class="filter-group">
                <button class="btn btn-primary" onclick="applyFilters()">应用筛选</button>
                <button class="btn btn-secondary" onclick="clearFilters()">清除筛选</button>
            </div>
        </div>
    </div>
    
    <div class="test-section">
        <h2>API测试结果</h2>
        <div id="results" class="results">点击"应用筛选"开始测试...</div>
    </div>

    <script>
        async function applyFilters() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.textContent = '正在加载...';
            
            try {
                // 收集筛选条件
                const params = new URLSearchParams({
                    page: 1,
                    limit: 10
                });
                
                // 价格筛选
                const priceFilter = document.getElementById('price-filter').value;
                if (priceFilter) {
                    if (priceFilter === '300+') {
                        params.append('minPrice', '300');
                    } else {
                        const [min, max] = priceFilter.split('-').map(Number);
                        if (min !== undefined) params.append('minPrice', min);
                        if (max !== undefined) params.append('maxPrice', max);
                    }
                }
                
                // 颜色筛选
                const colorCheckboxes = document.querySelectorAll('input[id^="color-"]:checked');
                if (colorCheckboxes.length > 0) {
                    const colors = Array.from(colorCheckboxes).map(cb => cb.value).join(',');
                    params.append('colors', colors);
                }
                
                // 尺码筛选
                const sizeCheckboxes = document.querySelectorAll('input[id^="size-"]:checked');
                if (sizeCheckboxes.length > 0) {
                    const sizes = Array.from(sizeCheckboxes).map(cb => cb.value).join(',');
                    params.append('sizes', sizes);
                }
                
                const url = `http://localhost:3001/api/products?${params.toString()}`;
                console.log('API URL:', url);
                
                const response = await fetch(url);
                const data = await response.json();
                
                resultsDiv.textContent = `API调用成功！
URL: ${url}

返回结果:
总数: ${data.pagination.total}
当前页商品数: ${data.products.length}

商品列表:
${data.products.map(p => `- ${p.name_zh}
  价格: ¥${p.current_price}
  颜色: [${p.available_colors.join(',')}]
  尺码: [${p.available_sizes.join(',')}]
  性别: ${p.gender}
`).join('\n')}`;
                
            } catch (error) {
                resultsDiv.textContent = `API调用失败: ${error.message}`;
            }
        }
        
        function clearFilters() {
            document.getElementById('price-filter').value = '';
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => cb.checked = false);
            document.getElementById('results').textContent = '筛选条件已清除，点击"应用筛选"开始测试...';
        }
        
        // 页面加载时进行初始测试
        window.addEventListener('load', () => {
            applyFilters();
        });
    </script>
</body>
</html>
