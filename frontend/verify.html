<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>功能验证</title>
    <link rel="stylesheet" href="css/variables.css?v=20250614">
    <link rel="stylesheet" href="css/base.css?v=20250614">
    <link rel="stylesheet" href="css/components.css?v=20250614">
    <link rel="stylesheet" href="css/layout.css?v=20250614">
    <link rel="stylesheet" href="css/pages.css?v=20250614">
    <style>
        .verification-container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .error {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        .product-demo {
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background-color: #f9f9f9;
        }
    </style>
</head>
<body>
    <div class="verification-container">
        <h1>功能验证页面</h1>
        
        <div id="verification-results"></div>
        
        <div class="product-demo">
            <h2>商品演示</h2>
            <div id="product-demo"></div>
        </div>
    </div>

    <script src="js/utils.js?v=20250614"></script>
    <script src="js/api.js?v=20250614"></script>
    <script>
        const resultsDiv = document.getElementById('verification-results');
        const productDemoDiv = document.getElementById('product-demo');
        
        function addResult(message, isSuccess) {
            const div = document.createElement('div');
            div.className = `test-result ${isSuccess ? 'success' : 'error'}`;
            div.textContent = message;
            resultsDiv.appendChild(div);
        }
        
        // 验证utils对象
        if (typeof utils !== 'undefined') {
            addResult('✓ utils对象加载成功', true);
            
            // 验证翻译函数
            const functions = ['translateColor', 'translateSize', 'translateColors', 'translateSizes', 'getUniqloProductUrl'];
            functions.forEach(func => {
                if (typeof utils[func] === 'function') {
                    addResult(`✓ ${func} 函数存在`, true);
                } else {
                    addResult(`✗ ${func} 函数不存在`, false);
                }
            });
            
            // 测试翻译功能
            try {
                const colorTest = utils.translateColor('COL12');
                const sizeTest = utils.translateSize('SMA003');
                
                if (colorTest === '粉色系') {
                    addResult('✓ 颜色翻译功能正常: COL12 → ' + colorTest, true);
                } else {
                    addResult('✗ 颜色翻译功能异常: COL12 → ' + colorTest, false);
                }
                
                if (sizeTest === 'S') {
                    addResult('✓ 尺码翻译功能正常: SMA003 → ' + sizeTest, true);
                } else {
                    addResult('✗ 尺码翻译功能异常: SMA003 → ' + sizeTest, false);
                }
                
                // 测试数组翻译
                const colorsTest = utils.translateColors(['COL12', 'COL09']);
                const sizesTest = utils.translateSizes(['SMA003', 'SMA004']);
                
                addResult(`✓ 颜色数组翻译: [COL12, COL09] → [${colorsTest.join(', ')}]`, true);
                addResult(`✓ 尺码数组翻译: [SMA003, SMA004] → [${sizesTest.join(', ')}]`, true);
                
                // 测试官网链接
                const urlTest1 = utils.getUniqloProductUrl('468503');
                const urlTest2 = utils.getUniqloProductUrl('477344', '/hmall/test/u0000000061803/main/first/561/1.jpg');

                addResult('✓ 基础链接生成: ' + urlTest1, true);
                addResult('✓ 带图片路径的链接生成: ' + urlTest2, true);

                if (urlTest2.includes('u0000000061803')) {
                    addResult('✓ 从图片路径提取产品ID成功', true);
                } else {
                    addResult('✗ 从图片路径提取产品ID失败', false);
                }
                
            } catch (error) {
                addResult('✗ 翻译功能测试出错: ' + error.message, false);
            }
        } else {
            addResult('✗ utils对象未加载', false);
        }
        
        // 验证API并演示商品
        if (typeof api !== 'undefined') {
            addResult('✓ api对象加载成功', true);
            
            api.getProduct('468503')
                .then(product => {
                    addResult('✓ API调用成功', true);
                    
                    // 创建商品演示
                    const translatedColors = utils.translateColors(product.available_colors || []);
                    const translatedSizes = utils.translateSizes(product.available_sizes || []);
                    
                    productDemoDiv.innerHTML = `
                        <h3>${product.name_zh}</h3>
                        <p><strong>商品编号:</strong> ${product.product_code}</p>
                        <p><strong>价格:</strong> ¥${product.current_price}</p>
                        
                        <div style="margin: 15px 0;">
                            <strong>原始数据:</strong><br>
                            颜色: ${JSON.stringify(product.available_colors)}<br>
                            尺码: ${JSON.stringify(product.available_sizes)}
                        </div>
                        
                        <div style="margin: 15px 0;">
                            <strong>翻译后:</strong><br>
                            <div style="margin: 5px 0;">
                                <span style="font-weight: bold;">颜色:</span>
                                ${translatedColors.map(color => `<span class="chip">${color}</span>`).join('')}
                            </div>
                            <div style="margin: 5px 0;">
                                <span style="font-weight: bold;">尺码:</span>
                                ${translatedSizes.map(size => `<span class="chip">${size}</span>`).join('')}
                            </div>
                        </div>
                        
                        <div style="margin: 15px 0;">
                            <p><strong>图片路径:</strong> ${product.main_pic}</p>
                            <p><strong>生成的官网链接:</strong> ${utils.getUniqloProductUrl(product.product_code, product.main_pic)}</p>
                            <a href="${utils.getUniqloProductUrl(product.product_code, product.main_pic)}"
                               target="_blank"
                               class="btn btn-outline-primary">
                                <i class="fas fa-external-link-alt"></i>
                                查看官网详情
                            </a>
                        </div>
                    `;
                    
                    addResult('✓ 商品演示创建成功', true);
                })
                .catch(error => {
                    addResult('✗ API调用失败: ' + error.message, false);
                });
        } else {
            addResult('✗ api对象未加载', false);
        }
    </script>
</body>
</html>
