# 更新日志 (Changelog)

本文档记录了优衣库价格监控系统的所有重要功能更新和改进。

## 🆕 v2.5 - 智能主题系统与端口配置化 (2025-07-12)

### 🌙 智能主题系统

全新的智能主题切换系统，提供更好的用户体验：

#### 核心特性
- **手动主题切换**: 导航栏新增主题切换按钮，支持浅色/深色模式一键切换
- **智能跟随系统**: 自动检测并跟随系统主题偏好设置
- **主题记忆**: 用户手动设置的主题偏好会被保存，下次访问时自动应用
- **完整适配**: 所有UI组件都经过优化，确保在两种模式下都有良好的视觉效果

#### 视觉优化
- **深色模式优化**: 调整了阴影、边框、背景色等，确保在深色背景下的可读性
- **动态图标**: 主题切换按钮图标会根据当前模式动态变化（月亮/太阳）
- **平滑过渡**: 主题切换时所有元素都有平滑的过渡动画效果
- **色彩调和**: 优化了主色调在深色模式下的亮度，提供更好的对比度

#### 技术实现
- **CSS变量系统**: 使用CSS自定义属性实现主题切换，性能优异
- **自动检测**: 监听系统主题变化，实时响应用户系统设置
- **状态管理**: 完善的主题状态管理，确保切换的一致性
- **兼容性**: 支持所有现代浏览器的主题偏好检测

### 🔧 端口配置化系统

优化了端口配置系统，提供更灵活的部署选项：

#### 核心特性
- **多种配置方式**: 支持环境变量、配置文件等多种端口配置方式
- **优先级机制**: 环境变量 > 配置文件 > 默认端口(3001)的清晰优先级
- **Docker支持**: 完整的Docker环境变量支持，便于容器化部署
- **启动脚本优化**: 所有启动脚本都支持动态端口配置

#### 使用方法
```bash
# 方式1: 环境变量
PORT=8080 ./start.sh --api-only

# 方式2: 配置文件
# 修改 config/default.json 中的 api.port

# 方式3: Docker
PORT=8080 docker-compose up -d
```

#### 技术改进
- **统一端口读取**: 所有组件都使用统一的端口读取逻辑
- **Docker优化**: 优化了Dockerfile和docker-compose.yml的端口配置
- **测试覆盖**: 提供了完整的端口配置测试脚本
- **详细文档**: 端口配置详情已整合到[部署指南](DEPLOYMENT.md)中

---

## 🆕 v2.4 - 真实库存验证系统 (2025-06-22)

### 🎯 核心功能

#### 真实库存API集成
- **官方API对接**: 集成优衣库官方库存查询API，获取准确的商品库存数据
- **实时库存验证**: 在商品详情页面实时查询并显示真实库存状态
- **智能筛选**: 自动过滤无库存的颜色和尺码组合
- **库存状态显示**: 清晰显示"有库存"、"无库存"、"查询中"等状态

#### 前端界面优化
- **库存筛选器**: 商品列表页面新增"仅显示有库存"筛选选项
- **动态更新**: 库存信息实时更新，无需刷新页面
- **视觉指示**: 使用颜色和图标清晰标识库存状态
- **用户体验**: 优化加载状态和错误处理

#### 技术实现
- **API封装**: 创建专门的库存查询服务模块
- **缓存机制**: 实现库存数据缓存，减少API调用频率
- **错误处理**: 完善的错误处理和重试机制
- **性能优化**: 批量查询和异步处理提升性能

---

## 🆕 v2.3 - 价格警报与库存筛选优化 (2025-06-15)

### 🔍 价格警报列表增强

#### 搜索功能
- **智能搜索**: 支持商品名称、编号、品牌等多维度搜索
- **实时搜索**: 输入即搜，无需点击搜索按钮
- **搜索高亮**: 搜索结果中关键词高亮显示
- **搜索历史**: 记住用户的搜索偏好

#### 性别筛选
- **完整分类**: 支持男装、女装、男女同款、童装等全部性别分类
- **智能匹配**: 自动识别商品性别属性
- **组合筛选**: 支持搜索和性别筛选的组合使用
- **状态保持**: 筛选状态在页面刷新后保持

### 📦 库存显示优化

#### 默认筛选
- **有库存优先**: 商品列表默认只显示有库存商品
- **一键切换**: 可快速切换显示全部商品或仅有库存商品
- **状态记忆**: 记住用户的筛选偏好设置
- **性能优化**: 优化查询逻辑，提升页面加载速度

#### 视觉改进
- **库存标识**: 清晰的库存状态图标和颜色标识
- **无库存提示**: 友好的无库存商品提示信息
- **加载状态**: 优化的加载动画和状态提示
- **响应式设计**: 在各种设备上都有良好的显示效果

---

## 🆕 v2.2 - 并发抓取与手动触发 (2025-06-08)

### 🚀 并发抓取系统

#### 性能提升
- **并发处理**: 支持多页面同时抓取，显著提升抓取速度
- **批次处理**: 将页面分批处理，避免服务器过载
- **智能调度**: 动态调整并发数量，平衡速度和稳定性
- **资源优化**: 优化内存使用和网络连接管理

#### 可靠性增强
- **智能重试**: 指数退避重试机制，提高成功率
- **错误隔离**: 单个页面失败不影响整体抓取进程
- **状态监控**: 实时监控抓取状态和进度
- **日志记录**: 详细的抓取日志和统计信息

### 🎮 手动触发功能

#### 前端控制
- **仪表板集成**: 在仪表板页面直接触发数据抓取
- **灵活配置**: 可自定义抓取页数和抓取器类型
- **实时反馈**: 显示抓取进度和结果统计
- **状态显示**: 实时更新抓取状态和剩余时间

#### 安全机制
- **并发限制**: 防止多个抓取任务同时运行
- **权限控制**: 确保只有授权用户可以触发抓取
- **资源保护**: 限制抓取频率，保护服务器资源
- **错误恢复**: 自动处理抓取异常和恢复机制

### ⚙️ 配置优化

#### 新增配置项
```json
{
  "scraper": {
    "concurrency": 3,              // 并发数
    "batchSize": 5,                // 批次大小
    "enableManualTrigger": true,   // 启用手动触发
    "maxConcurrentScraping": 1     // 最大并发抓取任务数
  }
}
```

#### 配置说明
- **concurrency**: 同时处理的页面数量（建议3-5）
- **batchSize**: 每批处理的页面数量（建议5-10）
- **enableManualTrigger**: 是否启用前端手动触发功能
- **maxConcurrentScraping**: 同时运行的抓取任务最大数量

---

## 📋 版本说明

### 版本命名规则
- **主版本号**: 重大功能更新或架构变更
- **次版本号**: 新功能添加或重要改进
- **修订版本号**: 问题修复和小幅优化

### 兼容性说明
- 所有版本都向后兼容
- 配置文件会自动迁移
- 数据库结构自动升级

### 升级建议
- 生产环境升级前请先备份数据
- 建议在测试环境验证新功能
- 查看配置文件变更说明

---

更多详细信息请参考：
- [部署指南](DEPLOYMENT.md)
- [API文档](API.md)
